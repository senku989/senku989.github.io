<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>Admin Dashboard - QBank</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.rtl.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">

  <style>
    body {
      background-color: #f8f9fa;
    }
    .dashboard-card {
      background: #fff;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    textarea {
      resize: none;
    }
    @media (max-width: 768px) {
      h1 {
        font-size: 1.5rem;
      }
    }
    /* Dark mode */
    .dark-mode {
      background-color: #121212;
      color: #eee;
    }
    .dark-mode .dashboard-card {
      background-color: #1e1e1e;
      color: #eee;
    }
    .dark-mode .form-select,
    .dark-mode .form-control {
      background-color: #222;
      color: #eee;
      border: 1px solid #444;
    }
  </style>
</head>
<body class="p-3">

  <div class="container">
    <div class="d-flex justify-content-between align-items-center mb-4">
      <h1 class="fw-bold">لوحة التحكم - إضافة أسئلة</h1>
      <!-- زر تبديل الوضع -->
      <button id="themeToggle" class="btn btn-light border rounded-circle p-2">
        <i id="themeIcon" class="fa-solid fa-moon"></i>
      </button>
    </div>

    <div class="dashboard-card">
      <form>
        <!-- اختيار الصف -->
        <div class="mb-3">
          <label class="form-label">اختر الصف</label>
          <select id="grade" class="form-select">
            <option value="10">الصف العاشر</option>
            <option value="11">الصف الحادي عشر</option>
            <option value="12">الصف الثاني عشر</option>
          </select>
        </div>

        <!-- اختيار الفصل -->
        <div class="mb-3">
          <label class="form-label">اختر الفصل الدراسي</label>
          <select id="semester" class="form-select">
            <option value="1">الفصل الأول</option>
            <option value="2">الفصل الثاني</option>
          </select>
        </div>

        <!-- اختيار المادة -->
        <div class="mb-3">
          <label class="form-label">اختر المادة</label>
          <select id="subject" class="form-select">
            <option value="arabic">اللغة العربية</option>
            <option value="islamic">التربية الإسلامية</option>
            <option value="math">الرياضيات</option>
            <option value="english">اللغة الإنجليزية</option>
            <option value="science">العلوم</option>
            <option value="physics">الفيزياء</option>
            <option value="chemistry">الكيمياء</option>
            <option value="biology">الأحياء</option>
            <option value="social">الدراسات الاجتماعية</option>
            <option value="national">التربية الوطنية</option>
            <option value="citizenship">الهوية والمواطنة</option>
            <option value="ict">تقنية المعلومات</option>
            <option value="skills">مهارات القرن 21</option>
            <option value="art">التربية الفنية</option>
            <option value="pe">التربية الرياضية</option>
            <option value="life">المهارات الحياتية</option>
            <option value="french">اللغة الفرنسية</option>
            <option value="german">اللغة الألمانية</option>
            <option value="chinese">اللغة الصينية</option>
            <option value="music">الموسيقى</option>
          </select>
        </div>

        <!-- إدخال الأسئلة -->
        <div class="mb-3">
          <label class="form-label">أدخل الأسئلة (بتنسيق محدد)</label>
          <textarea id="questionsInput" class="form-control" rows="10"
            placeholder="Q: السؤال...\nA) خيار أول\nB) خيار ثاني\nC) خيار ثالث\nD) خيار رابع\nANSWER: A\nLEVEL: سهل\n---"></textarea>
        </div>

        <!-- زر رفع -->
        <button type="button" id="uploadBtn" class="btn btn-primary w-100 fw-bold rounded-pill">
          <i class="fa-solid fa-upload me-2"></i> رفع الأسئلة
        </button>
      </form>

      <!-- رسالة حالة -->
      <div id="status" class="mt-3 fw-bold text-center"></div>
    </div>
  </div>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database.js"></script>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
    import { getDatabase, ref, push } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyAdPFwWxQ1SbOTBUnHyJU9ji1CyHzluMUU",
  authDomain: "quizzes-8edd4.firebaseapp.com",
  projectId: "quizzes-8edd4",
  storageBucket: "quizzes-8edd4.firebasestorage.app",
  messagingSenderId: "567385584064",
  appId: "1:567385584064:web:bcef8d81c2e3db16e11825",
  measurementId: "G-EW7TGSHREG"
};

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    // رفع الأسئلة
    document.getElementById("uploadBtn").addEventListener("click", () => {
      const grade = document.getElementById("grade").value;
      const semester = document.getElementById("semester").value;
      const subject = document.getElementById("subject").value;
      const rawText = document.getElementById("questionsInput").value.trim();

      if (!rawText) {
        document.getElementById("status").innerText = "⚠️ الرجاء إدخال الأسئلة.";
        return;
      }

      const blocks = rawText.split("---").map(b => b.trim()).filter(b => b);

      const questions = blocks.map(block => {
        const lines = block.split("\n").map(l => l.trim()).filter(l => l);
        const qLine = lines.find(l => l.startsWith("Q:")) || "";
        const options = lines.filter(l => /^[A-D]\)/.test(l));
        const answerLine = lines.find(l => l.startsWith("ANSWER:")) || "";
        const levelLine = lines.find(l => l.startsWith("LEVEL:")) || "";

        return {
          question: qLine.replace("Q:", "").trim(),
          options: options.map(o => o.trim()),
          answer: answerLine.replace("ANSWER:", "").trim(),
          level: levelLine.replace("LEVEL:", "").trim()
        };
      });

      const path = `questions/${grade}/${semester}/${subject}`;
      const refPath = ref(db, path);

      questions.forEach(q => {
        push(refPath, q);
      });

      document.getElementById("status").innerText = "✅ تم رفع الأسئلة بنجاح!";
      document.getElementById("questionsInput").value = "";
    });

    // Toggle Dark/Light Mode
    const themeToggle = document.getElementById("themeToggle");
    const themeIcon = document.getElementById("themeIcon");
    const savedTheme = localStorage.getItem("qbank-theme");

    if (savedTheme === "dark") {
      document.body.classList.add("dark-mode");
      themeIcon.classList.replace("fa-moon", "fa-sun");
    }

    themeToggle.addEventListener("click", () => {
      document.body.classList.toggle("dark-mode");

      if (document.body.classList.contains("dark-mode")) {
        themeIcon.classList.replace("fa-moon", "fa-sun");
        localStorage.setItem("qbank-theme", "dark");
      } else {
        themeIcon.classList.replace("fa-sun", "fa-moon");
        localStorage.setItem("qbank-theme", "light");
      }
    });
  </script>
</body>
</html>