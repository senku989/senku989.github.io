<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>إنشاء حساب — QBank</title>

  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&display=swap" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
  <link rel="stylesheet" href="style.css">

  <style>
    .auth-card { max-width:520px; margin:30px auto; }
    .floating-whatsapp { position:fixed; bottom:18px; right:18px; z-index:9999; width:60px; height:60px; border-radius:50%; display:flex; align-items:center; justify-content:center; font-size:24px; color:#fff; background:#25D366; box-shadow:0 6px 18px rgba(0,0,0,0.18); }
    .top-controls { position:fixed; top:18px; left:18px; display:flex; gap:8px; z-index:999; }
    .control-btn { background:var(--card-bg, #fff); border:1px solid rgba(0,0,0,0.06); padding:8px 10px; border-radius:10px; cursor:pointer; }
  </style>
</head>
<body class="login-body">

  <div class="top-controls">
    <button id="backBtn" class="control-btn">الرئيسية</button>
    <button id="langBtn" class="control-btn"><i class="fa-solid fa-language"></i></button>
    <button id="themeBtn" class="control-btn"><i id="themeIcon" class="fa-solid fa-moon"></i></button>
  </div>

  <div class="auth-card p-5 shadow-lg rounded-4">
    <div class="text-center mb-3">
      <img src="assets/images/qbank-logo.png" alt="QBank" class="logo-img mb-2">
      <h3 id="title" class="fw-bold">إنشاء حساب جديد</h3>
      <p id="subtitle" class="text-muted small-text">انضم إلينا وابدأ رحلتك مع بنك الأسئلة الذكي</p>
    </div>

    <form id="signupForm">
      <div class="mb-3 input-group">
        <span class="input-group-text"><i class="fa-solid fa-user"></i></span>
        <input id="name" type="text" class="form-control" placeholder="اسمك الثلاثي" required>
      </div>

      <div class="mb-3 input-group">
        <span class="input-group-text"><i class="fa-solid fa-envelope"></i></span>
        <input id="email" type="email" class="form-control" placeholder="example@gmail.com" required>
      </div>

      <div class="mb-3 input-group">
        <span class="input-group-text"><i class="fa-solid fa-lock"></i></span>
        <input id="password" type="password" class="form-control" placeholder="كلمة المرور" required>
      </div>

      <button id="signupBtn" type="submit" class="btn btn-primary w-100 rounded-pill fw-bold mb-3">
        <i class="fa-solid fa-user-plus me-2"></i> <span id="signupBtnText">إنشاء حساب</span>
      </button>

      <button id="googleSignupBtn" type="button" class="google-btn w-100 mb-2">
        <img src="assets/images/google.png" alt="Google" style="width:22px"> <span id="googleText"> المتابعة عبر جوجل</span>
      </button>

      <p class="text-center mt-3 small-text">
        لديك حساب بالفعل؟ <a id="loginLink" href="login.html" class="app-link fw-bold">تسجيل الدخول</a>
      </p>
    </form>

    <p id="err" style="color:#cc3333; text-align:center; margin-top:8px;"></p>
    <p id="ok" style="color:#148a00; text-align:center; margin-top:8px;"></p>
  </div>

  <a id="whatsapp" class="floating-whatsapp" href="https://wa.me/96891234567" target="_blank" title="دعم فني">
    <i class="fa-brands fa-whatsapp"></i>
  </a>

  <script type="module">
    import { initFirebase, signupWithEmail, loginWithGoogle, friendlyErrorMessage } from './firebase.js';
    initFirebase();

    const signupForm = document.getElementById('signupForm');
    const errEl = document.getElementById('err');
    const okEl = document.getElementById('ok');
    const backBtn = document.getElementById('backBtn');
    const langBtn = document.getElementById('langBtn');
    const themeBtn = document.getElementById('themeBtn');
    const themeIcon = document.getElementById('themeIcon');

    const strings = {
      ar: { title: "إنشاء حساب جديد", subtitle: "انضم إلينا وابدأ رحلتك مع بنك الأسئلة الذكي", signup: "إنشاء حساب", google: " المتابعة عبر جوجل", haveAccount: "لديك حساب بالفعل؟" },
      en: { title: "Sign Up", subtitle: "Join and start your journey with the Question Bank", signup: "Create Account", google: " Continue with Google", haveAccount: "Already have an account?" }
    };

    function getSavedTheme(){ return localStorage.getItem('qbank-theme') || 'light'; }
    function getSavedLang(){ return localStorage.getItem('qbank-lang') || 'ar'; }

    function applyTheme(t) {
      if (t === 'dark') document.body.classList.add('dark-mode'); else document.body.classList.remove('dark-mode');
      if (document.body.classList.contains('dark-mode')) themeIcon.classList.replace('fa-moon','fa-sun'); else themeIcon.classList.replace('fa-sun','fa-moon');
    }
    function applyLang(l) {
      const s = strings[l] || strings.ar;
      document.getElementById('title').textContent = s.title;
      document.getElementById('subtitle').textContent = s.subtitle;
      document.getElementById('signupBtnText').textContent = s.signup;
      document.getElementById('googleText').textContent = s.google;
      if (l === 'ar') { document.documentElement.lang='ar'; document.documentElement.dir='rtl'; }
      else { document.documentElement.lang='en'; document.documentElement.dir='ltr'; }
    }

    applyTheme(getSavedTheme());
    applyLang(getSavedLang());

    themeBtn.addEventListener('click', () => {
      const next = document.body.classList.contains('dark-mode') ? 'light' : 'dark';
      localStorage.setItem('qbank-theme', next);
      applyTheme(next);
    });

    langBtn.addEventListener('click', () => {
      const next = getSavedLang() === 'ar' ? 'en' : 'ar';
      localStorage.setItem('qbank-lang', next);
      applyLang(next);
    });

    backBtn.addEventListener('click', () => { window.location.href = 'index.html'; });

    signupForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      errEl.textContent = ''; okEl.textContent = '';
      const name = document.getElementById('name').value.trim();
      const email = document.getElementById('email').value.trim();
      const password = document.getElementById('password').value;
      if (!name || !email || !password) { errEl.textContent = "املأ جميع الحقول"; return; }
      try {
        await signupWithEmail(name, email, password);
        okEl.textContent = "تم إنشاء الحساب! تحقق من بريدك (إن وُجد).";
        setTimeout(()=> window.location.href = 'dashboard.html', 1200);
      } catch (err) {
        console.error(err);
        errEl.textContent = friendlyErrorMessage(err) || 'حدث خطأ';
      }
    });

    document.getElementById('googleSignupBtn').addEventListener('click', async () => {
      try {
        await loginWithGoogle();
        window.location.href = 'dashboard.html';
      } catch (err) {
        console.error(err);
        errEl.textContent = friendlyErrorMessage(err) || 'حدث خطأ';
      }
    });
  </script>
</body>
</html>
