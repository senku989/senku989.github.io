<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>الوصول إلى الكتاب - تسجيل الدخول</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600&display=swap" rel="stylesheet">
    <!-- Firebase SDKs -->
    <script type="module">
        // استخدم معلومات التهيئة الخاصة بك من Firebase Console
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-app.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-auth.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBICzx31xe84VL1ApfnZcMv7WpeGKMLGDc",
            authDomain: "mybook-27306.firebaseapp.com",
            projectId: "mybook-27306",
            storageBucket: "mybook-27306.firebasestorage.app",
            messagingSenderId: "1036259156306",
            appId: "1:1036259156306:web:91fc319f437cc498c89a8b",
            measurementId: "G-13XTR0FJV2"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);

        // جعل كائنات Firebase متاحة بشكل عام للاستخدام في الملفات الأخرى
        window.firebaseApp = app;
        window.firebaseAuth = auth;
        window.firebaseAuthFunctions = { createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged };
    </script>
    <style>
        body {
            font-family: 'Cairo', sans-serif;
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
        }
        .auth-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 1.5rem;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        }
        .form-control:focus {
            border-color: #10b981;
            box-shadow: 0 0 0 0.25rem rgba(16, 185, 129, 0.25);
        }
        .btn-auth {
            background-color: #10b981;
            border: none;
            padding: 0.75rem;
            font-weight: 600;
        }
        .btn-auth:hover {
            background-color: #059669;
        }
        .tab-active {
            color: #10b981 !important;
            border-bottom: 3px solid #10b981 !important;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-8 col-lg-6">
                <div class="auth-card p-4 p-md-5">
                    <div class="text-center mb-5">
                        <h2 class="fw-bold">الوصول إلى الكتاب</h2>
                        <p class="text-muted">سجّل الدخول باستخدام بريدك الإلكتروني للوصول الكامل إلى كتاب "الطريق إلى 1000$ شهريًا".</p>
                    </div>

                    <ul class="nav nav-tabs nav-justified mb-4" id="authTab" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active w-100 tab-active" id="login-tab" data-bs-toggle="tab" data-bs-target="#login" type="button" role="tab">تسجيل الدخول</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link w-100" id="signup-tab" data-bs-toggle="tab" data-bs-target="#signup" type="button" role="tab">إنشاء حساب جديد</button>
                        </li>
                    </ul>

                    <div class="tab-content" id="authTabContent">
                        <!-- تسجيل الدخول -->
                        <div class="tab-pane fade show active" id="login" role="tabpanel">
                            <form id="loginForm">
                                <div class="mb-3">
                                    <label for="loginEmail" class="form-label">البريد الإلكتروني</label>
                                    <input type="email" class="form-control form-control-lg" id="loginEmail" required>
                                </div>
                                <div class="mb-4">
                                    <label for="loginPassword" class="form-label">كلمة المرور</label>
                                    <input type="password" class="form-control form-control-lg" id="loginPassword" required>
                                </div>
                                <div class="d-grid mb-3">
                                    <button type="submit" class="btn btn-auth btn-lg">تسجيل الدخول</button>
                                </div>
                                <div id="loginMessage" class="text-center small"></div>
                            </form>
                        </div>

                        <!-- إنشاء حساب -->
                        <div class="tab-pane fade" id="signup" role="tabpanel">
                            <form id="signupForm">
                                <div class="mb-3">
                                    <label for="signupEmail" class="form-label">البريد الإلكتروني</label>
                                    <input type="email" class="form-control form-control-lg" id="signupEmail" required>
                                </div>
                                <div class="mb-4">
                                    <label for="signupPassword" class="form-label">كلمة المرور (6 أحرف على الأقل)</label>
                                    <input type="password" class="form-control form-control-lg" id="signupPassword" minlength="6" required>
                                </div>
                                <div class="d-grid mb-3">
                                    <button type="submit" class="btn btn-auth btn-lg">إنشاء حساب جديد</button>
                                </div>
                                <div id="signupMessage" class="text-center small"></div>
                            </form>
                        </div>
                    </div>

                    <div class="text-center mt-4 pt-4 border-top">
                        <p class="small text-muted">بتسجيل الدخول، فإنك توافق على <a href="terms.html">شروط الخدمة</a> و <a href="privacy.html">سياسة الخصوصية</a>.</p>
                        <p class="small">إذا واجهتك مشكلة، رجاءً <a href="mailto:support@yourdomain.com">اتصل بالدعم</a>.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // تأكد من تحميل Firebase SDK أولاً
        document.addEventListener('DOMContentLoaded', function() {
            const loginForm = document.getElementById('loginForm');
            const signupForm = document.getElementById('signupForm');
            const loginMessage = document.getElementById('loginMessage');
            const signupMessage = document.getElementById('signupMessage');

            // استيراد الدوال من الكائن العام الذي عرفناه في الـ <script type="module">
            const { createUserWithEmailAndPassword, signInWithEmailAndPassword } = window.firebaseAuthFunctions;
            const auth = window.firebaseAuth;

            // تسجيل الدخول
            if(loginForm) {
                loginForm.addEventListener('submit', async (e) => {
                    e.preventDefault();
                    const email = document.getElementById('loginEmail').value;
                    const password = document.getElementById('loginPassword').value;
                    loginMessage.textContent = 'جاري تسجيل الدخول...';
                    loginMessage.className = 'text-center small text-info';

                    try {
                        const userCredential = await signInWithEmailAndPassword(auth, email, password);
                        // النجاح! توجيه إلى صفحة الكتاب
                        loginMessage.textContent = 'تم تسجيل الدخول بنجاح! يتم توجيهك الآن...';
                        loginMessage.className = 'text-center small text-success';
                        setTimeout(() => {
                            window.location.href = 'book.html';
                        }, 1500);
                    } catch (error) {
                        console.error("خطأ في تسجيل الدخول:", error);
                        loginMessage.textContent = 'خطأ: ' + getAuthErrorMessage(error.code);
                        loginMessage.className = 'text-center small text-danger';
                    }
                });
            }

            // إنشاء حساب جديد
            if(signupForm) {
                signupForm.addEventListener('submit', async (e) => {
                    e.preventDefault();
                    const email = document.getElementById('signupEmail').value;
                    const password = document.getElementById('signupPassword').value;
                    signupMessage.textContent = 'جاري إنشاء حسابك...';
                    signupMessage.className = 'text-center small text-info';

                    try {
                        const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                        // النجاح!
                        signupMessage.textContent = 'تم إنشاء حسابك بنجاح! يتم توجيهك إلى الكتاب...';
                        signupMessage.className = 'text-center small text-success';
                        setTimeout(() => {
                            window.location.href = 'book.html';
                        }, 1500);
                    } catch (error) {
                        console.error("خطأ في إنشاء الحساب:", error);
                        signupMessage.textContent = 'خطأ: ' + getAuthErrorMessage(error.code);
                        signupMessage.className = 'text-center small text-danger';
                    }
                });
            }

            function getAuthErrorMessage(errorCode) {
                const messages = {
                    'auth/email-already-in-use': 'هذا البريد الإلكتروني مستخدم بالفعل.',
                    'auth/invalid-email': 'صيغة البريد الإلكتروني غير صحيحة.',
                    'auth/weak-password': 'كلمة المرور ضعيفة. يجب أن تكون 6 أحرف على الأقل.',
                    'auth/user-not-found': 'لا يوجد حساب مرتبط بهذا البريد.',
                    'auth/wrong-password': 'كلمة المرور غير صحيحة.',
                    'auth/too-many-requests': 'عدد محاولات تسجيل الدخول كبير جدًا. حاول مرة أخرى لاحقًا.'
                };
                return messages[errorCode] || 'حدث خطأ غير متوقع. حاول مرة أخرى.';
            }
        });
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>